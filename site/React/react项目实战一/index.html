<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>React项目实战一 - Chen's Blog</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>
    	
    	<div class="huiji animate"></div>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Chen's Blog</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Angular <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Angular/Angular4%E4%B8%8A%E6%89%8B%E5%88%9D%E4%BD%93%E9%AA%8C/">Angular4上手初体验</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HtmlCssEs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../HtmlCssEs/CSS%E6%80%BB%E7%BB%93/">CSS总结</a>
</li>
                            
<li >
    <a href="../../HtmlCssEs/canvas%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0/">Canvas日常笔记</a>
</li>
                            
<li >
    <a href="../../HtmlCssEs/ios%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/">Ios的一些坑</a>
</li>
                            
<li >
    <a href="../../HtmlCssEs/jCanvas/">jCanvas</a>
</li>
                            
<li >
    <a href="../../HtmlCssEs/jQuery%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E6%8F%92%E4%BB%B6%E6%B1%87%E6%80%BB%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/">jQuery一些好用插件汇总（持续更新）</a>
</li>
                            
<li >
    <a href="../../HtmlCssEs/%E5%9B%BE%E7%89%87%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F%2Bcanvas%E6%B6%82%E9%B8%A6/">图片放大缩小+canvas涂鸦</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">React <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../react%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%E4%B8%80/">React入门教程一</a>
</li>
                            
<li >
    <a href="../react%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%E4%BA%8C/">React入门教程二</a>
</li>
                            
<li class="active">
    <a href="./">React项目实战一</a>
</li>
                            
<li >
    <a href="../%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BAreact%E9%A1%B9%E7%9B%AE/">脚手架快速构建react项目</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Vue <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../Vue/Vue-router%202/">Vue router 2</a>
</li>
                            
<li >
    <a href="../../Vue/vue%202/">Vue 2</a>
</li>
                            
<li >
    <a href="../../Vue/vue%2Bweixin-js-sdk/">Vue+weixin js sdk</a>
</li>
                            
<li >
    <a href="../../Vue/vue%E4%B8%8E%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92/">Vue与后端数据交互</a>
</li>
                            
<li >
    <a href="../../Vue/vux%202/">Vux 2</a>
</li>
                            
<li >
    <a href="../../Vue/%E4%BD%BF%E7%94%A8vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6/">使用vue cli脚手架搭建项目框架</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">建站相关 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/MD%E6%96%87%E6%A1%A3%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E7%A7%81%E4%BA%BA%E5%8D%9A%E5%AE%A2/">MD文档快速构建私人博客</a>
</li>
                            
<li >
    <a href="../../%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/Nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">Nginx安装与配置</a>
</li>
                            
<li >
    <a href="../../%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/Node.JS%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">Node.JS安装配置</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">微信小程序 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AA%E4%BA%BA%E8%B4%A6%E5%8F%B7%E7%94%B3%E8%AF%B7/">微信小程序个人账号申请</a>
</li>
                            
<li >
    <a href="../../%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A5%E9%97%A8/">微信小程序入门</a>
</li>
                            
<li >
    <a href="../../%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E6%8C%87%E5%8D%97%E9%92%88/">指南针</a>
</li>
                            
<li >
    <a href="../../%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E7%AE%80%E5%8E%86%E5%88%86%E4%BA%ABdemo/">简历分享demo</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right" style="display: none;">
                    <li >
                        <a rel="next" href="../react%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%E4%BA%8C/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BAreact%E9%A1%B9%E7%9B%AE/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/Anthony0416" target="_blank">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#react">react项目实战一</a></li>
            <li><a href="#_1">准备工作</a></li>
            <li><a href="#_4">熟悉结构</a></li>
            <li><a href="#react-">React实战一 -- 页面导航</a></li>
            <li><a href="#react-_1">React实战二 -- 表单综合练习</a></li>
            <li><a href="#_7">踩坑</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="react">react项目实战一</h2>
<p>在前面的入门教程之后肯定很多人都会摩拳擦掌跃跃欲试。我这里就准备一个入门demo，帮助大家快速上手react。</p>
<p>之前在找react脚手架的时候找到了很多好东西，这里就是其中之一。有人把它归类为脚手架，其实他更像一个简单的demo。麻雀虽小五脏俱全，新手可以使用这个demo快速去熟悉react的项目结构。源demo Github：<a href="https://github.com/JasonBai007/react-seed">React-seed</a></p>
<h3 id="_1">准备工作</h3>
<h4 id="_2">克隆项目</h4>
<p>这里给没有使用过Github的小白提供一个简单的方法，点击上面链接，再打开的页面中找到绿色的 <strong>Clone or download</strong> 按钮，点击后在弹窗中选择 Download ZIP  ，稍等片刻，浏览器就会把项目zip压缩包下载到本地。解压放到合适的路径即可。</p>
<p>使用过Github的同学就用你熟悉的方法克隆项目到本地。</p>
<h4 id="node">检查node环境</h4>
<p>在这一步之前首选确保你电脑中安装有Node.JS，没有安装的同学可以去 <a href="https://nodejs.org/en/download/">Node.JS官网</a> 下载最新版安装包安装。安装后打开控制台键入 <code>node -v</code>  ，控制台打印出版本号即视为安装成功。</p>
<h4 id="_3">安装依赖</h4>
<p>项目中用到了Yarn，yarn是facebook推出的开源JavaScript包管理器，速度优于npm。</p>
<p>使用控制台定位到项目目录，安装yarn和项目依赖，相关命令如下：</p>
<blockquote>
<p>安装Yarn  : npm install -g yarn</p>
<p>安装依赖  : yarn</p>
</blockquote>
<p>第一次使用yarn安装依赖会经常报错，而这多是网络问题（毕竟国外源），你可以多试几次，或者尝试这些解决办法：<a href="https://cnodejs.org/topic/57ff0541487e1e4578afb48d">「CYarn」使用 cnpm 源的 Yarn</a> 。而在以后安装时由于yarn的离线性，速度会巨快 。当然用不惯yarn的也可以使用npm，命令差不多的。</p>
<h3 id="_4">熟悉结构</h3>
<h4 id="_5">项目目录</h4>
<pre><code>├── README.md                            // 项目说明文档
├── webpack.config.js                    // webpack开发配置
├── webpack.production.config.js         // webpack打包配置
├── .babelrc                             // babel配置文件
├── .gitignore                           // github上传忽略文件配置
├── package.json                         // 项目配置文件
├── yarn.lock                            // 记录依赖包的具体版本号，保证每个开发的依赖都是一样的
├── node_modules                         // 依赖包存放目录
├── docs                                 // 作者Github.io托管静态页面目录，可以删除
└── app                                  // 项目目录
    ├── dist                             // 打包目录
    ├── src                              // 开发目录
    │   ├── components                   // 组件目录
    │   ├── data                         // mock假数据存放目录
    │   ├── images                       // 图片目录
    │   ├── less                         // 样式文件目录
    │   ├── pages                        // 页面级jsx目录
    │   ├── main.jsx                     // 页面框架
    │   └── router.jsx                   // 路由配置文件
    ├── favivon.icon                     // 页面标题icon
    └── index.html                       // 项目入口文件
</code></pre>

<p>项目目录十分清晰明了，我们首先查看package.json。这里可以看出项目中使用了   <a href="https://daneden.github.io/animate.css/">animate.css</a>   <a href="https://ant.design/docs/react/introduce-cn">antd</a>   <a href="http://jquery.cuishifeng.cn/index.html">jquery</a>   <a href="https://tianxiangbing.github.io/react-cn/docs/getting-started.html">react,react-dom</a>   <a href="http://www.ruanyifeng.com/blog/2016/05/react_router.html?utm_source=tool.lu">react-router</a>  除此之外，项目还使用了 <a href="http://lesscss.cn/">less</a>  和  <a href="http://es6.ruanyifeng.com/">ES6</a> ，不会这些也没关系，CSS 和 ES5 一样可以。</p>
<p>其次熟悉一下Babel配置，打开.babelrc 。presets用于设定转码规则，es2015就是ES6，而stage代表es7的提案，后面的数字代表提案的四个阶段，分别是0-3，然后是react。</p>
<p>plugins则是插件的转码，这里作者也写了注释说明是为了做到antd插件的按需调用。</p>
<p>然后是Webpack的配置，这里作者使用了 webpack.config.js  和 webpack.production.config.js 分别定义了Webpack的开发配置和打包配置。对比两个配置可以看出，开发配置多了本地服务器的配置，但为了节省时间没有做压缩。而打包配置则专注于线上项目，加入了项目的压缩和控制台警告处理。</p>
<p>这个项目的webpack配置是一份十分标准的配置，初学者也可以不用费太大力气去读懂，而且配置比较完善。但在图片这里有个小坑，相信作者也清楚，在配置中写了注释标明publicPath会影响图片的打包路径。如果你也遇到了这样的问题，可以去文末寻找答案。</p>
<h4 id="_6">项目结构</h4>
<p>调出命令行，定位到当前目录键入 <code>yarn start</code>  项目即自动打包并调出浏览器打开 localhost:8080。如果你8080端口被占用，可以打开 webpack.config.js  手动修改端口号，不要忘记同时修改下方的 OpenBrowserPlugin 不然下次自动打开的依然是8080。</p>
<p>现在你可以看到demo的效果了：</p>
<p><img alt="1" src="../MdImages/1.jpg" /></p>
<p>该项目使用react-router做路由实现页面切换，通过router.jsx可以看到项目中的每个页面通过 <code>&lt;Router/&gt;</code> 实现按需加载，并最终通过ReactDOM.render渲染到index.html的 <code>#init</code> 中。</p>
<p>这里会用到一些React-Router的知识，如果你完全不会，不用担心，我会在后面单独讲这个。在这里你可以先不用管路由， 专心练习和巩固之前的入门知识。</p>
<h3 id="react-">React实战一 -- 页面导航</h3>
<p>打开 Sidebar.jsx 可以看出，该项目的侧栏导航栏使用 antd 制作，今天我们实战就是抛弃UI库，自己去写一个react的导航栏。在这个过程中深刻体会react的魅力所在。</p>
<p>首先删掉原有的Sidebar.jsx中的相关代码。一般我们做导航都是 ul li 结构，这里也采用这样的结构，废话不多说，直接上我写的代码：</p>
<pre><code>import React from 'react';
import { browserHistory } from 'react-router';

export default class Sidebar extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            current: ''
        }
    }

    handleClick = (e) =&gt; {
        let id = e.target.id;
        this.setState({ current: id });
        if(id == &quot;home&quot;){
            browserHistory.push('/');
        }else{
            browserHistory.push(id);
        }
    }

    componentDidMount() {
        var now = window.location.pathname.substring(1);
        now = now === '' ? 'home' : now;
        this.setState({ current: now });
    }

    render() {
        return (
            &lt;div id=&quot;leftMenu&quot;&gt; 
                &lt;img src={require('../images/logo.png')} width=&quot;50&quot; id=&quot;logo&quot;/&gt;
                &lt;ul onClick={this.handleClick}&gt;
                    &lt;li id=&quot;home&quot; className={this.state.current == 'home' ? 'choosed' : 'none'}&gt;首页&lt;/li&gt;
                    &lt;li className={this.state.current == 'list' || this.state.current == 'report' ? 'choose' : 'none'}&gt;导航一
                        &lt;ul&gt;
                            &lt;li id=&quot;list&quot; className={this.state.current == 'list' ? 'choosed' : 'none'}&gt;子导航一&lt;/li&gt;
                            &lt;li id=&quot;report&quot; className={this.state.current == 'report' ? 'choosed' : 'none'}&gt;子导航二&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/li&gt;
                    &lt;li id=&quot;user&quot; className={this.state.current == 'user' ? 'choosed' : 'none'}&gt;用户中心&lt;/li&gt;
                    &lt;li id=&quot;setting&quot; className={this.state.current == 'setting' ? 'choosed' : 'none'}&gt;系统配置&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;                
        )
    }
}
</code></pre>

<p>样式除了排版之外使用伪类 <code>:hover</code> 给每个li添加了鼠标触发样式，这里不在列出，感兴趣的可以去我的Github下载查看。</p>
<p>从上往下看，首先import引入所有的依赖，这里用到了两个，react和react-router的 browserHistory 。这里先补充一个router的知识点：<em>browserHistory.push('/path')  //跳转到某个路径</em> ，后面会用到这个来做路由跳转。</p>
<p>继续往下看： <code>export default class Sidebar extends React.Component{}</code> 这句话意思是声明一个名为Sidebar的react组件并暴露来，这样在使用到这个组件的时候我们就可以通过import { 组件名 } from 路径，来将这个组件引入进来。</p>
<p>中间内容先跳过，我们直接来看下面的<code>render()</code>：这里结构很简单明了，一个div标签包裹ul li 结构，前面有讲到，render只能包含一个顶层标签，这里就是div。</p>
<p>这里几个小细节：首先本地图片使用 require() 引入，这么做是因为webpack打包会忽略掉js中的 url() 引入的图片（将其作为网络资源对待）。其次，这里给li添加样式的时候使用className而不是class，我在教程中有提到，class是JS的保留字。这里直接使用{}包裹的三元运算符来做样式的一个判断。</p>
<p>事件绑定这里只在最外层ul做了一次onClick的绑定，但是实际上你console.log(e.target)可以看到，react可以准确返回你点击的DOM。（前面入门教程二对react事件机制做了介绍）所以这里直接使用e.target.id就可以准确返回出你所点击的li标签的id，我们用这个值去刷新state，同时使用browserHistory.push() 去处理路由。</p>
<p>componentDidMount() 和 constructor() 我们在声明周期里提到了一下。前者是组件渲染后的回调函数，即组件在页面渲染完成后会立即执行componentDidMount()中的函数。而constructor()则是在组件渲染之前需要声明的一些元素，一般用来定义组件的props和state，props使用<code>constructor(props) { super(props); }</code>定义，state则是使用 <code>this.state = { }</code> 来定义。如果项目中需要全局变量，也可以在这里声明。</p>
<p>到这里，导航就完成了，别急，这只是开胃菜，接下来我们再来一个复杂的页面。</p>
<h3 id="react-_1">React实战二 -- 表单综合练习</h3>
<p>这里我们完成一个用户表单</p>
<h3 id="_7">踩坑</h3>
<h4 id="background">background图片路径问题</h4>
<p>webpack中图片配置路径为dist/img/[name].[ext]，在实际打包中，因为react的虚拟Dom插入到index.html中，所以这样的路径相当于站在index的当前目录去寻找dist/img，当然能找到。但是css样式被打包成bundle.css放在dist/css目录下，而写在less中的background-image的实际寻找路径就变成了从当前目录出发的dist/css/dist/img...，所以会出现找到不图片的原因。</p>
<p>~~解决中尝试使用内联样式将backgroundImage放在jsx中，但是发现webpack打包时忽略了！即便尝试手动拷贝图片到dist/img，save一下热加载再次打包图片又没了！~~  后来发现这样其实是可以的，但是我这里引用图片使用的是url，html中的url在webpack中视为网络资源文件，在打包的时候会自动忽略掉，所以这里需要使用require引入图片。</p>
<p>后来尝试改变webpack开发配置，将publicPath路径修改为/，在loaders的图片配置将输出路径改为./dist/img/[name]的绝对路径，成功。同时为了保证其他打包资源的路径正确性，需要把其他所有的“js/”和“css/”前面都添加“dist/”。</p>
<p>然后修改打包配置，将path由/app/dist改为/app，publicPath由/dist改为/，loaders图片输出配置由/img/[name]改为./dist/img/[name]，其他所有的“js/”和“css/”前面都添加“dist/”。</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2017 | Powered By Chen Shiwen | <a href="www.miitbeian.gov.cn">粤ICP备</a>17030492号-1</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/" target="_blank">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
